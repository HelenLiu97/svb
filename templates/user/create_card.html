<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
    <script src="/static/layui/layui.js"></script>
    <style>
        .divForm{
            /*{#position: absolute;!*绝对定位*!#}*/
            width: 500px;
            height: 400px;
            /*{#border: 3px solid darkgray;#}*/
            /*{#text-align: center;!*(让div中的内容居中)*!#}*/
            top: 50%;
            left: 50%;
            margin-bottom: 300px;
            margin-top: 100px;
            margin-left: 36%;
        }

        .opacity_bg {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background: #000;
        opacity: 0.6;
        margin: auto;
        z-index: 1024;
        display: none;
    }

        #logo {
            font-weight: 900;
            font-size: 20px;
            font-family: "黑体";
            color: #898989;
            background: -webkit-linear-gradient(45deg, #39eef6, #f86527, #fcd72d, #5f2cf8, #bed5f5);
        -moz-linear-gradient(45 deg, #70f7fe, #fbd7c6, #fdefac, #bfb5dd, #bed5f5);
        -ms-linear-gradient(45 deg, #70f7fe, #fbd7c6, #fdefac, #bfb5dd, #bed5f5);
            color: transparent;
            /*设置字体颜色透明*/
            -webkit-background-clip: text;
            /*背景裁剪为文本形式*/
            animation: ran 10s linear infinite;
            /*动态10s展示*/
        }

        @keyframes ran {
            from {
                backgroud-position: 0 0;
            }
            to {
                background-position: 2000px 0;
            }
        }
    </style>
</head>
<body>
<!--
<div id="logo" style="padding-top: 20px; padding-left: 40%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优惠活动<br>
通过批量购卡功能可低价<br>购卡，购卡量100张起。<br>价格低至2刀</div>
<div style="padding-top: 20px; padding-left: 42%">
    <button  class="layui-btn layui-btn-lg layui-btn-radius layui-btn-normal" id="buy_card">批量购卡</button>
</div>
-->
<div class="divForm">
    <form class="layui-form layui-form-pane" onsubmit="return false">
        <div class="layui-form-item">
            <label class="layui-form-label">充值金额</label>
            <div class="layui-input-inline">
                <select name="top_money" id="top_money">
                    <option value="2">2</option>
                    <option value="10">10</option>
                  </select>
            </div>
            <div class="layui-form-mid layui-word-aux">暂支持10刀/2刀余额</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">标签</label>
            <div class="layui-input-inline">
                <input type="text" id="label" name="label" placeholder="卡标签" autocomplete="off"
                       class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">单价: $ <span id="price">{{ create_price }}</span></div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">建卡数量</label>
            <div class="layui-input-inline">
                <input type="number" id="card_num" name="card_num" value="1" autocomplete="off"
                       class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">合计: $ <span id="sum_money">0</span></div>
        </div>

        <div class="layui-form-item">
	    <label class="layui-form-label">国家</label>
            <div  class="layui-input-inline">
                <select name="country" lay-search="">
                  <option value=""></option>
                  <option value="US">US(美国)</option>
                </select>
            </div>
        </div>

        <div class="layui-form-item">
	    <label class="layui-form-label">州</label>
            <div  class="layui-input-inline">
                <select name="state"  lay-search="">
                  <option value="">直接选择或搜索选择</option>
                  <option value="AL">AL(阿拉巴马州)</option>
                  <option value="AK">AK(阿拉斯加州)</option>
                  <option value="AZ">AZ(亚利桑那州)</option>
                  <option value="AR">AR(阿肯色州)</option>
                  <option value="CA">CA(加利福尼亚州)</option>
                  <option value="CO">CO(科罗拉多州)</option>
                  <option value="CT">CT(康涅狄格州)</option>
                  <option value="DE">DE(特拉华州)</option>
                  <option value="DC">DC(哥伦毕亚特区)</option>
                  <option value="FL">FL(佛罗里达州)</option>
                  <option value="GA">GA(乔治亚州)</option>
                  <option value="HI">HI(夏威夷州)</option>
                  <option value="ID">ID(爱达荷州 )</option>
                  <option value="IL">IL(伊利诺斯州)</option>
                  <option value="IN">IN(印第安纳州)</option>
                  <option value="IA">IA(爱荷华州)</option>
                  <option value="KS">KS(堪萨斯州)</option>
                  <option value="KY">KY(肯塔基州)</option>
                  <option value="LA">LA(路易斯安那州)</option>
                  <option value="ME">ME(缅因州)</option>
                  <option value="MD">MD(马里兰州)</option>
                  <option value="MA">MA(马萨诸塞州)</option>
                  <option value="MI">MI(密歇根州)</option>
                  <option value="MN">MN(明尼苏达州)</option>
                  <option value="MS">MS(密西西比州)</option>
                  <option value="MO">MO(密苏里州)</option>
                  <option value="MT">MT(蒙大拿州)</option>
                  <option value="NE">NE(内布拉斯加州)</option>
                  <option value="NV">NV(内华达州)</option>
                  <option value="NH">NH(新罕布什尔州)</option>
                  <option value="NJ">NJ(新泽西州)</option>
                  <option value="NM">NM(新墨西哥州)</option>
                  <option value="NY">NY(纽约州)</option>
                  <option value="NC">NC(北卡罗来纳州)</option>
                  <option value="ND">ND(北达科他州)</option>
                  <option value="OH">OH(俄亥俄州)</option>
                  <option value="OK">OK(俄克拉荷马州)</option>
                  <option value="OR">OR(俄勒冈州)</option>
                  <option value="PA">PA(宾夕法尼亚州)</option>
                  <option value="RI">RI(罗得岛州)</option>
                  <option value="SC">SC(南卡罗来纳州)</option>
                  <option value="SD">SD(南达科他州)</option>
                  <option value="TN">TN(田纳西州)</option>
                  <option value="TX">TX(德克萨斯州)</option>
                  <option value="UT">UT(犹他州)</option>
                  <option value="VT">VT(佛蒙特州)</option>
                  <option value="VA">VA(弗吉尼亚州)</option>
                  <option value="WA">WA(华盛顿州)</option>
                  <option value="WV">WV(西弗吉尼亚州)</option>
                  <option value="WI">WI(威斯康辛州)</option>
                  <option value="WY">WY(怀俄明州)</option>
                  <option value="VI">VI(美属维尔京群岛)</option>
                  <option value="PR">PR(波多黎各)</option>
                </select>
            </div>
        </div>

        <div class="layui-form-item">
	    <label class="layui-form-label">城市</label>
            <div  class="layui-input-inline">
                <input type="text" name="city" placeholder="城市" autocomplete="off"
                       class="layui-input" id="top_money">
            </div>
        </div>

        <div class="layui-form-item">
	    <label class="layui-form-label">街道</label>
            <div  class="layui-input-inline">
                <input type="text" name="street" placeholder="街道" autocomplete="off"
                       class="layui-input" id="top_money">
            </div>
        </div>

        <div class="layui-form-item">
	    <label class="layui-form-label">邮编</label>
            <div  class="layui-input-inline">
                <input type="text" name="zipcode" placeholder="邮编" autocomplete="off"
                       class="layui-input" id="top_money">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button  class="layui-btn layui-btn-lg demo-active" lay-submit="" lay-filter="create_one" id="sub" type="submit">确认</button>
            </div>
        </div>
    </form>
    </div>
<script>
    layui.use(['form','jquery'], function () {
        var form=layui.form,
            $=layui.jquery;

        function accAdd(num1, num2) {
            var r1, r2, m;
            try {
                r1 = num1.toString().split('.')[1].length;
            } catch (e) {
                r1 = 0;
            }
            try {
                r2 = num2.toString().split(".")[1].length;
            } catch (e) {
                r2 = 0;
            }
            m = Math.pow(10, Math.max(r1, r2));
            // return (num1*m+num2*m)/m;
            return Math.round(num1 * m + num2 * m) / m;
        }

        function accMul(num1, num2) {
            var m = 0, s1 = num1.toString(), s2 = num2.toString();
            try {
                m += s1.split(".")[1].length
            } catch (e) {
            }
            try {
                m += s2.split(".")[1].length
            } catch (e) {
            }
            return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m);
        }

        $(function () {
            $('#card_num').bind('input propertychange', function () {
                var card_num = $('#card_num').val(),
                    price = $('#price').text(),
                    limit = $("#top_money").val();
                var one_card = accAdd(limit, price);
                var sum = accMul(one_card, card_num);
                $('#sum_money').html(sum);
            });
        });

        $(function () {
            $('#top_money').bind('input propertychange', function () {
                var card_num = $('#card_num').val(),
                    price = $('#price').text(),
                    limit = $("#top_money").val();
                var one_card = accAdd(limit, price);
                var sum = accMul(one_card, card_num);
                $('#sum_money').html(sum);
            });
        });

        form.on('submit(create_one)', function(data){
	        // 单击之后提交按钮不可选,防止重复提交
            var DISABLED = 'layui-btn-disabled';
            // 增加样式
            $('.demo-active').addClass(DISABLED);
            // 增加属性
            $('.demo-active').attr('disabled', true);

            var data_info = {data:JSON.stringify(data.field)};
            $.ajax({
				type : 'POST',
				url : '/user/create_card/',
				data : data_info,
				dataType : 'json',
                beforeSend:function () {
                     top.layer.load(0, {shade: [0.8, '#393D49'],})
                },
				success : function(data) {
					// 成功提示框
                    if (data.code == 0){
                        top.layer.closeAll();
                        parent.layer.msg(data.msg, {
						icon : 6,time:4000
					});
                        location.reload();
                    }else if(data.code == 502){
                        top.layer.closeAll();
                        parent.layer.msg(data.msg, {
						icon : 5
					});
                    }

				},
				error : function(data) {
					// 异常提示
					parent.layer.msg('出现网络故障', {
						icon : 5
					});
					location.reload()
				},
				complete:function () {
                    // 增加样式
                    $('.demo-active').removeClass(DISABLED);
                    // 增加属性
                    $('.demo-active').attr('disabled', false);
                }
			});
			return false;
            });

        $("#buy_card").click(function () {
            layer.open({
                type: 2,
                area: ['500px', '400px'],
                content: '/user/free_card/' //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
            });
        })
    })
</script>
</body>
</html>